"use strict";(self["webpackChunkionic_car_trading"]=self["webpackChunkionic_car_trading"]||[]).push([[720],{2255:function(e,t,a){a.d(t,{Z:function(){return g}});a(6699);var s=a(2262),n=a(5052),r=a(7724);const{getAuthUser:u}=(0,n.Z)(),o=u,c=(0,s.qj)({chatId:"null",user:{uid:""}}),l=(0,s.iH)([]);function d(e){return l.value.filter((t=>t[1].userInfo.displayName.includes(e)))}async function i(e){const t=await(0,r.it)(u.value.uid,e);console.log(t),f(t[1].userInfo)}function f(e){c.chatId=o.value.uid>e.uid?o.value.uid+e.uid:e.uid+o.value.uid,c.user=e}function g(){return{chatState:c,userChats:l,setChatState:f,filterUserChats:d,setChatStateByUserId:i}}},2387:function(e,t,a){a.d(t,{Z:function(){return c}});var s=a(1989),n=a(6252),r=(0,n.aZ)({props:["src","alt"],setup(e){return(t,a)=>{const r=s.Xz;return(0,n.wg)(),(0,n.j4)(r,{alt:e.alt,src:e.src},null,8,["alt","src"])}}}),u=a(3744);const o=(0,u.Z)(r,[["__scopeId","data-v-7c013d27"]]);var c=o},720:function(e,t,a){a.r(t),a.d(t,{default:function(){return ie}});var s=a(1989),n=a(6252),r=a(2262),u=a(3577),o=a(7115),c=a(2255),l=a(2387);const d={class:"messageInfo flex"};var i=(0,n.aZ)({setup(e){const{chatState:t}=(0,c.Z)();return(e,a)=>{const c=s.wd;return(0,n.wg)(),(0,n.j4)(o.Z,{default_href:"/chats"},{title:(0,n.w5)((()=>[(0,n._)("div",d,[(0,n.Wm)(l.Z,{src:(0,r.SU)(t).user.photoURL,alt:"user img"},null,8,["src"]),(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,u.zw)((0,r.SU)(t).user.displayName),1)])),_:1})])])),default:(0,n.w5)((()=>[(0,n.WI)(e.$slots,"default")])),_:3})}}}),f=a(3744);const g=(0,f.Z)(i,[["__scopeId","data-v-eef00f8a"]]);var m=g;function p(e,t,a,s,r,u){return(0,n.WI)(e.$slots,"default")}var v=a(7724),h=a(5052),w=(0,n.aZ)({props:["dealerID"],async setup(e){const{getAuthUser:t}=(0,h.Z)(),{setChatStateByUserId:a}=(0,c.Z)();return await(0,v.zb)(t.value,e.dealerID),await a(e.dealerID),{}}});const I=(0,f.Z)(w,[["render",p]]);var y=I,U=a(9963);const _={class:"h-16 p-3 flex items-center justify-between"},Z={class:"send flex items-center gap-2"},D=(0,n.Uk)("Send");function x(e,t,a,r,u,o){const c=s.YG;return(0,n.wg)(),(0,n.iD)("div",_,[(0,n.wy)((0,n._)("input",{class:"w-full outline-none",type:"text",placeholder:"Type something...","onUpdate:modelValue":t[0]||(t[0]=t=>e.text=t),onKeyup:t[1]||(t[1]=(0,U.D2)((async()=>await e.handleSend()),["enter"]))},null,544),[[U.nr,e.text]]),(0,n._)("div",Z,[(0,n.Wm)(c,{onClick:t[2]||(t[2]=async()=>await e.handleSend())},{default:(0,n.w5)((()=>[D])),_:1})])])}var C=a(1294),S=a(3964);const W="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var M={randomUUID:W};let b;const j=new Uint8Array(16);function k(){if(!b&&(b="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!b))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return b(j)}const H=[];for(let fe=0;fe<256;++fe)H.push((fe+256).toString(16).slice(1));function A(e,t=0){return(H[e[t+0]]+H[e[t+1]]+H[e[t+2]]+H[e[t+3]]+"-"+H[e[t+4]]+H[e[t+5]]+"-"+H[e[t+6]]+H[e[t+7]]+"-"+H[e[t+8]]+H[e[t+9]]+"-"+H[e[t+10]]+H[e[t+11]]+H[e[t+12]]+H[e[t+13]]+H[e[t+14]]+H[e[t+15]]).toLowerCase()}function z(e,t,a){if(M.randomUUID&&!t&&!e)return M.randomUUID();e=e||{};const s=e.random||(e.rng||k)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=s[e];return t}return A(s)}var J=z;const{getAuthUser:V}=(0,h.Z)(),B=V,{chatState:K}=(0,c.Z)(),L=(0,r.iH)([]);async function R(e,t){const a=await(0,v.Ti)(t);await(0,C.r7)((0,C.JU)(S.cW,"chats",K.chatId),{messages:(0,C.vr)({id:J(),text:e,senderId:B.value.uid,date:C.EK.now(),img:a})})}async function E(e){await(0,C.r7)((0,C.JU)(S.cW,"chats",K.chatId),{messages:(0,C.vr)({id:J(),text:e,senderId:B.value.uid,date:C.EK.now()})}),await N(e,B.value.uid)}async function N(e,t){await(0,C.r7)((0,C.JU)(S.cW,"userChats",B.value.uid),{[K.chatId+".lastMessage"]:{text:e,senderId:t},[K.chatId+".date"]:(0,C.Bt)()}),await(0,C.r7)((0,C.JU)(S.cW,"userChats",K.user.uid),{[K.chatId+".lastMessage"]:{text:e,senderId:t},[K.chatId+".date"]:(0,C.Bt)()})}function T(){return(0,C.cf)((0,C.JU)(S.cW,"chats",K.chatId),(e=>{console.log(e.data()),e.exists()&&(L.value=e.data().messages)})),{messages:L,sendImgMessage:R,sendMessage:E}}var Y=(0,n.aZ)({setup(){const{sendImgMessage:e,sendMessage:t}=T(),a=(0,r.iH)(""),s=(0,r.iH)(null),n=async()=>{s.value?await e(a.value,s.value):a.value&&await t(a.value),a.value="",s.value=null};return{text:a,img:s,handleSend:n}}});const $=(0,f.Z)(Y,[["render",x]]);var q=$;const G={class:"messageContent flex flex-col gap-2"},X={class:"relative"};function F(e,t,a,s,r,o){return(0,n.wg)(),(0,n.iD)("div",{ref:"self",class:(0,u.C_)(["message flex gap-5 mb-4 mx-3 mt-1",e.message.senderId===e.getAuthUser.uid&&"owner"])},[(0,n._)("div",G,[(0,n._)("div",null,[(0,n._)("p",X,[(0,n._)("span",null,(0,u.zw)(e.message.text),1),(0,n._)("small",null,(0,u.zw)(e.moment(e.message.date.toDate()).format("DD MMM HH:mm")),1)])])])],2)}var O=a(381),P=a.n(O),Q=(0,n.aZ)({props:["message"],setup(){const e=(0,r.iH)(),{getAuthUser:t}=(0,h.Z)(),{chatState:a}=(0,c.Z)(),s=a.user;return(0,n.bv)((()=>{e.value?.scrollIntoView({behavior:"smooth"})})),{getAuthUser:t,userInfo:s,self:e,moment:P()}}});const ee=(0,f.Z)(Q,[["render",F],["__scopeId","data-v-17956fc1"]]);var te=ee;const ae={class:"messages overflow-y-scroll"};function se(e,t,a,s,r,u){const o=te;return(0,n.wg)(),(0,n.iD)("div",ae,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.messages,(e=>((0,n.wg)(),(0,n.j4)(o,{key:e.id,message:e},null,8,["message"])))),128))])}var ne=(0,n.aZ)({components:{ChatMessage:te},setup(){const{messages:e}=T();return{messages:e}}});const re=(0,f.Z)(ne,[["render",se],["__scopeId","data-v-25e7f780"]]);var ue=re;function oe(e,t,a,r,u,o){const c=ue,l=q,d=y,i=s.wh,f=m;return(0,n.wg)(),(0,n.j4)(f,null,{default:(0,n.w5)((()=>[((0,n.wg)(),(0,n.j4)(n.n4,null,{default:(0,n.w5)((()=>[(0,n.Wm)(d,{dealerID:e.routeDealerID},{default:(0,n.w5)((()=>[(0,n.Wm)(c),(0,n.Wm)(l)])),_:1},8,["dealerID"])])),fallback:(0,n.w5)((()=>[(0,n.Wm)(i)])),_:1}))])),_:1})}var ce=a(2119),le=(0,n.aZ)({components:{MessagesLayout:m,ChatMessages:ue,ChatInput:q,IonLoading:s.wh,ChatManager:y},setup(){const e=(0,ce.yj)(),t=e.params.dealerID;return{routeDealerID:t}}});const de=(0,f.Z)(le,[["render",oe]]);var ie=de}}]);
//# sourceMappingURL=720.548e9766.js.map